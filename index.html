<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GridGap: Where Clean Energy Is Needed Most</title>
<meta name="description" content="The places that need clean energy most are the least prepared. Explore the gap between grid reliability and renewable potential across the US.">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
  background: #0a0f1a;
  color: #e2e8f0;
  min-height: 100vh;
}

/* Header */
.hero {
  background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #1a1020 100%);
  border-bottom: 1px solid #1e3a5f;
  padding: 50px 20px 40px;
  text-align: center;
  position: relative;
  overflow: hidden;
}
.hero::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(ellipse at 30% 50%, rgba(251,191,36,0.04) 0%, transparent 60%),
              radial-gradient(ellipse at 70% 50%, rgba(248,113,113,0.04) 0%, transparent 60%);
  pointer-events: none;
}
.hero h1 {
  font-size: 2.8rem;
  font-weight: 800;
  background: linear-gradient(90deg, #fbbf24, #f87171, #fb923c);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  margin-bottom: 10px;
  position: relative;
}
.hero .tagline {
  font-size: 1.2rem;
  color: #94a3b8;
  max-width: 650px;
  margin: 0 auto 6px;
  position: relative;
}
.hero .sub-tagline {
  font-size: 0.95rem;
  color: #64748b;
  position: relative;
}

/* Stats bar */
.stats-bar {
  display: flex;
  justify-content: center;
  gap: 40px;
  padding: 24px 20px;
  background: #0f172a;
  border-bottom: 1px solid #1e293b;
  flex-wrap: wrap;
}
.stat-item { text-align: center; }
.stat-value {
  font-size: 1.8rem;
  font-weight: 700;
  color: #fbbf24;
}
.stat-value.green { color: #34d399; }
.stat-value.red { color: #f87171; }
.stat-value.blue { color: #38bdf8; }
.stat-label {
  font-size: 0.8rem;
  color: #64748b;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-top: 4px;
}

/* Main grid */
.main {
  max-width: 1200px;
  margin: 0 auto;
  padding: 30px 20px;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;
}
@media (max-width: 900px) {
  .main { grid-template-columns: 1fr; }
  .hero h1 { font-size: 2rem; }
  .stats-bar { gap: 20px; }
  .stat-value { font-size: 1.4rem; }
  .narrative-steps { flex-direction: column; align-items: center; }
}

.card {
  background: #1e293b;
  border-radius: 12px;
  padding: 24px;
  border: 1px solid #334155;
}
.card h2 {
  font-size: 1.1rem;
  font-weight: 600;
  margin-bottom: 4px;
}
.card .subtitle {
  font-size: 0.85rem;
  color: #64748b;
  margin-bottom: 16px;
}
.card.full-width { grid-column: 1 / -1; }

/* Select */
select {
  background: #0f172a;
  color: #e2e8f0;
  border: 1px solid #334155;
  padding: 8px 14px;
  border-radius: 8px;
  font-size: 0.95rem;
  cursor: pointer;
  margin-bottom: 16px;
}

/* Insight box */
.insight-box {
  background: #0f172a;
  border: 1px solid #334155;
  border-left: 4px solid #fbbf24;
  border-radius: 8px;
  padding: 16px 20px;
  margin-top: 16px;
  font-size: 0.9rem;
  color: #94a3b8;
  line-height: 1.5;
}

/* Narrative section */
.narrative {
  grid-column: 1 / -1;
  text-align: center;
  padding: 30px;
}
.narrative h2 {
  font-size: 1.4rem;
  margin-bottom: 12px;
  color: #f8fafc;
}
.narrative-steps {
  display: flex;
  justify-content: center;
  gap: 30px;
  flex-wrap: wrap;
  margin-top: 20px;
}
.narrative-step {
  background: #1e293b;
  border-radius: 12px;
  padding: 24px;
  width: 300px;
  border: 1px solid #334155;
  text-align: left;
}
.narrative-step .step-label {
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  margin-bottom: 8px;
  font-weight: 600;
}
.narrative-step .step-label.setup { color: #fbbf24; }
.narrative-step .step-label.conflict { color: #f87171; }
.narrative-step .step-label.resolution { color: #34d399; }
.narrative-step p {
  font-size: 0.9rem;
  color: #94a3b8;
  line-height: 1.6;
}
.narrative-step .big-number {
  font-size: 1.6rem;
  font-weight: 700;
  margin: 8px 0;
}

/* GridGap Index table */
.index-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 12px;
}
.index-table th {
  text-align: left;
  padding: 10px 12px;
  color: #94a3b8;
  font-size: 0.8rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  border-bottom: 1px solid #334155;
}
.index-table td {
  padding: 10px 12px;
  border-bottom: 1px solid #1e293b;
  font-size: 0.9rem;
}
.index-table tr:hover { background: rgba(251,191,36,0.05); }
.rank-badge {
  display: inline-block;
  width: 28px;
  height: 28px;
  line-height: 28px;
  text-align: center;
  border-radius: 50%;
  font-weight: 700;
  font-size: 0.85rem;
}
.rank-1 { background: #f87171; color: #0f172a; }
.rank-2 { background: #fb923c; color: #0f172a; }
.rank-3 { background: #fbbf24; color: #0f172a; }
.rank-4 { background: #facc15; color: #0f172a; }
.rank-5 { background: #a3e635; color: #0f172a; }
.gap-bar {
  height: 8px;
  border-radius: 4px;
  background: linear-gradient(90deg, #f87171, #fbbf24);
}

/* Case study cards */
.case-studies {
  display: flex;
  gap: 20px;
  margin-top: 16px;
  flex-wrap: wrap;
}
.case-card {
  flex: 1;
  min-width: 200px;
  background: #0f172a;
  border-radius: 10px;
  padding: 18px;
  border: 1px solid #334155;
}
.case-card h3 {
  font-size: 1rem;
  font-weight: 600;
  margin-bottom: 4px;
}
.case-card .case-label {
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  margin-bottom: 10px;
}
.case-card .case-label.before { color: #f87171; }
.case-card .case-label.after { color: #34d399; }
.case-card .case-stat {
  font-size: 1.8rem;
  font-weight: 700;
  margin: 6px 0;
}
.case-card p {
  font-size: 0.85rem;
  color: #94a3b8;
  line-height: 1.5;
}

/* Slider */
.slider-section {
  grid-column: 1 / -1;
  background: linear-gradient(135deg, #1e293b, #0f172a);
  border-radius: 12px;
  padding: 30px;
  border: 1px solid #334155;
  text-align: center;
}
.slider-section h2 { font-size: 1.3rem; margin-bottom: 6px; }
.slider-section .subtitle {
  color: #64748b;
  font-size: 0.9rem;
  margin-bottom: 20px;
}
.slider-row {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 16px;
  margin-bottom: 16px;
}
input[type="range"] {
  -webkit-appearance: none;
  width: 500px;
  max-width: 80%;
  height: 8px;
  border-radius: 4px;
  background: linear-gradient(90deg, #334155, #fbbf24);
  outline: none;
}
input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 22px;
  height: 22px;
  border-radius: 50%;
  background: #fbbf24;
  cursor: pointer;
  box-shadow: 0 0 10px rgba(251,191,36,0.5);
}
.slider-value {
  font-size: 1.5rem;
  font-weight: 700;
  color: #fbbf24;
  min-width: 80px;
}
.impact-result {
  font-size: 1.05rem;
  color: #34d399;
  margin-top: 10px;
  min-height: 28px;
  line-height: 1.5;
}

/* Footer */
.footer {
  text-align: center;
  padding: 24px 20px;
  color: #475569;
  font-size: 0.8rem;
  border-top: 1px solid #1e293b;
  margin-top: 20px;
  line-height: 1.6;
}
.footer a { color: #fbbf24; text-decoration: none; }
.footer a:hover { text-decoration: underline; }

canvas { max-height: 300px; }
</style>
</head>
<body>

<!-- HERO -->
<div class="hero">
  <h1>GridGap</h1>
  <p class="tagline">The places that need clean energy most are the least prepared.</p>
  <p class="sub-tagline">Mapping the gap between grid failure and renewable potential across America.</p>
</div>

<!-- STATS BAR -->
<div class="stats-bar">
  <div class="stat-item">
    <div class="stat-value red">83%</div>
    <div class="stat-label">Outages Caused by Grid Failure</div>
  </div>
  <div class="stat-item">
    <div class="stat-value">7x / year</div>
    <div class="stat-label">Avg American Loses Power</div>
  </div>
  <div class="stat-item">
    <div class="stat-value red">16x</div>
    <div class="stat-label">Gap: Best vs Worst State</div>
  </div>
  <div class="stat-item">
    <div class="stat-value green">65%</div>
    <div class="stat-label">Outage Drop with Solar+Storage</div>
  </div>
  <div class="stat-item">
    <div class="stat-value blue">$18B/yr</div>
    <div class="stat-label">Savings from Fixing 500 Worst Counties</div>
  </div>
</div>

<!-- MAIN -->
<div class="main">

<!-- NARRATIVE -->
<div class="narrative">
  <h2>The Story in Three Acts</h2>
  <div class="narrative-steps">
    <div class="narrative-step">
      <div class="step-label setup">Setup</div>
      <div class="big-number" style="color:#fbbf24;">246 Deaths</div>
      <p>Texas 2021. The grid collapsed during a winter freeze, killing 246 people. Texas has the most wind energy potential in the country AND had the deadliest grid failure in modern US history. The grid is old. The grid is failing. Americans lose power 7 times a year &mdash; twice the rate of any other developed country.</p>
    </div>
    <div class="narrative-step">
      <div class="step-label conflict">Conflict</div>
      <div class="big-number" style="color:#f87171;">32 hrs vs 2 hrs</div>
      <p>Louisiana customers lose power 32 hours per year. DC loses 2. Same country, 16x gap. The worst states &mdash; Louisiana, Mississippi, West Virginia &mdash; are sitting on the best solar and wind resources on the planet. Louisiana has 5.2 peak sun hours/day but ranks 45th in solar deployment. Mississippi has zero installed wind capacity.</p>
    </div>
    <div class="narrative-step">
      <div class="step-label resolution">Resolution</div>
      <div class="big-number" style="color:#34d399;">0 Seconds</div>
      <p>Babcock Ranch, Florida. Hurricane Ian &mdash; 150 mph winds. Surrounding area went dark. Babcock Ranch never lost power. Not for a second. Solar + battery microgrids deployed at the county level cut outage hours by 65%. This isn't about saving the planet &mdash; it's about keeping the lights on.</p>
    </div>
  </div>
</div>

<!-- CHART 1: Top States by Outage Hours -->
<div class="card">
  <h2>Grid Reliability by State</h2>
  <div class="subtitle">Average outage hours per customer/year (SAIDI) &mdash; EIA-861</div>
  <canvas id="outageChart"></canvas>
</div>

<!-- CHART 2: Renewable Potential vs Outages -->
<div class="card">
  <h2>The Mismatch: Outages vs Solar Potential</h2>
  <div class="subtitle">Worst grids sit on the best sunshine</div>
  <canvas id="mismatchChart"></canvas>
</div>

<!-- CHART 3: GridGap Index -->
<div class="card full-width">
  <h2>The GridGap Index</h2>
  <div class="subtitle">Ranking states by: (grid unreliability x renewable potential) / actual deployment</div>
  <table class="index-table">
    <thead>
      <tr>
        <th>Rank</th>
        <th>State</th>
        <th>Outage Hrs/Yr</th>
        <th>Solar Potential</th>
        <th>Renewable Deployed</th>
        <th>Median Income</th>
        <th>GridGap Score</th>
      </tr>
    </thead>
    <tbody id="indexBody"></tbody>
  </table>
  <div class="insight-box" style="margin-top:20px;">
    <strong>The equity angle:</strong> The top 5 GridGap states have median household incomes 20-30% below the national average ($75,149). The people paying the most for unreliable power are the people who can afford it the least.
  </div>
</div>

<!-- CHART 4: State Explorer -->
<div class="card">
  <h2>State Deep Dive</h2>
  <div class="subtitle">Pick a state to see its grid story</div>
  <select id="stateSelect">
    <option value="LA">Louisiana</option>
    <option value="MS">Mississippi</option>
    <option value="WV">West Virginia</option>
    <option value="AL">Alabama</option>
    <option value="KY">Kentucky</option>
    <option value="TX">Texas</option>
    <option value="ME">Maine</option>
    <option value="CA">California</option>
    <option value="FL">Florida</option>
    <option value="NY">New York</option>
  </select>
  <canvas id="stateDetailChart"></canvas>
  <div class="insight-box" id="stateInsight"></div>
</div>

<!-- CHART 5: Power source breakdown -->
<div class="card">
  <h2>Energy Source: GridGap States</h2>
  <div class="subtitle">Where the worst grids still get their power</div>
  <canvas id="sourceChart"></canvas>
</div>

<!-- CASE STUDIES -->
<div class="card full-width">
  <h2>Proof It Works: Before &amp; After</h2>
  <div class="subtitle">Communities that closed their GridGap</div>
  <div class="case-studies">
    <div class="case-card">
      <div class="case-label before">Before</div>
      <h3>Borrego Springs, CA</h3>
      <div class="case-stat" style="color:#f87171;">24 hrs/yr</div>
      <p>Desert community at the end of a single transmission line. Constant outages from heat waves and equipment failure.</p>
    </div>
    <div class="case-card">
      <div class="case-label after">After</div>
      <h3>Borrego Springs, CA</h3>
      <div class="case-stat" style="color:#34d399;">&lt; 2 hrs/yr</div>
      <p>Installed solar + battery microgrid in 2013. Same community, same weather, same location. Outages dropped 92%.</p>
    </div>
    <div class="case-card">
      <div class="case-label after">Built Right</div>
      <h3>Babcock Ranch, FL</h3>
      <div class="case-stat" style="color:#34d399;">0 seconds</div>
      <p>Hurricane Ian, 2022. 150 mph winds. Entire surrounding area lost power. Babcock Ranch &mdash; solar + battery from day one &mdash; never flickered.</p>
    </div>
  </div>
</div>

<!-- SIMULATOR -->
<div class="slider-section">
  <h2>What-If: Closing the GridGap</h2>
  <div class="subtitle">If we deployed solar + storage to the 500 worst counties, what happens?</div>
  <div class="slider-row">
    <span style="color:#64748b;">0%</span>
    <input type="range" min="0" max="100" value="0" id="deploySlider">
    <span class="slider-value" id="deployLabel">0%</span>
  </div>
  <canvas id="simChart" style="max-height:280px;margin:0 auto;max-width:700px;"></canvas>
  <div class="impact-result" id="impactResult">Drag the slider to deploy solar + storage to underserved counties.</div>
</div>

<!-- CHART 6: International Comparison -->
<div class="card full-width">
  <h2>America vs The World</h2>
  <div class="subtitle">Average annual outage hours per customer &mdash; the US is an outlier among developed nations</div>
  <canvas id="worldChart" style="max-height:250px;"></canvas>
</div>

</div><!-- /main -->

<div class="footer">
  Data: <a href="https://www.eia.gov/electricity/data/eia861/">EIA-861</a> |
  <a href="https://www.nrel.gov/gis/solar.html">NREL Solar</a> |
  <a href="https://www.energy.gov/">DOE</a> |
  <a href="https://www.noaa.gov/">NOAA</a> |
  <a href="https://data.census.gov/">Census ACS</a><br>
  Built by Juan, Ismael &amp; Kevin &mdash; Pursuit Cycle 3
</div>

<script>
// =========================================================
//  DATA (EIA-861, NREL, DOE, Census ACS)
// =========================================================

// Top 10 states by SAIDI (outage hours/customer/year)
const outageStates = ['LA','MS','WV','ME','AL','KY','MI','OK','SC','TX'];
const outageHours  = [32, 28, 22, 19, 18, 17, 15, 14, 13, 12];

// Solar potential (peak sun hours/day) for same states
const solarPotential = [5.2, 5.0, 3.8, 3.4, 5.1, 4.0, 3.6, 5.3, 5.0, 5.8];

// For comparison: best reliability states
const reliableStates = ['DC','NE','ND','SD','WI'];
const reliableHours  = [2, 3, 3.5, 4, 4.5];

// GridGap Index data
const gridgapData = [
  {rank:1, state:'Louisiana',      outage:32, solar:'5.2 hrs', deployed:'2%',  income:'$52,295', score:94, barW:100},
  {rank:2, state:'Mississippi',    outage:28, solar:'5.0 hrs', deployed:'1%',  income:'$48,610', score:88, barW:94},
  {rank:3, state:'West Virginia',  outage:22, solar:'3.8 hrs', deployed:'<1%', income:'$51,248', score:82, barW:87},
  {rank:4, state:'Alabama',        outage:18, solar:'5.1 hrs', deployed:'3%',  income:'$55,958', score:76, barW:81},
  {rank:5, state:'Kentucky',       outage:17, solar:'4.0 hrs', deployed:'1%',  income:'$55,573', score:71, barW:76},
  {rank:6, state:'Michigan',       outage:15, solar:'3.6 hrs', deployed:'3%',  income:'$63,202', score:58, barW:62},
  {rank:7, state:'Oklahoma',       outage:14, solar:'5.3 hrs', deployed:'11%', income:'$55,826', score:52, barW:55},
  {rank:8, state:'South Carolina', outage:13, solar:'5.0 hrs', deployed:'4%',  income:'$59,318', score:48, barW:51},
  {rank:9, state:'Maine',          outage:19, solar:'3.4 hrs', deployed:'5%',  income:'$64,767', score:44, barW:47},
  {rank:10,state:'Texas',          outage:12, solar:'5.8 hrs', deployed:'18%', income:'$67,321', score:38, barW:40},
];

// State detail data
const stateDetail = {
  'LA': {outage:32, solar:5.2, wind:0.4, deployed:2, coal:4, gas:68, nuclear:16, renewable:2, hydro:2, other:8,
    insight:"Louisiana has world-class solar potential (5.2 peak sun hours/day) but ranks 45th in solar deployment. 68% of electricity comes from natural gas. The state loses 32 hours of power per customer per year while the sun beats down on it."},
  'MS': {outage:28, solar:5.0, wind:0.3, deployed:1, coal:8, gas:72, nuclear:13, renewable:1, hydro:0, other:6,
    insight:"Mississippi has strong wind corridors in the north and excellent solar across the state. Installed wind capacity: 0 MW. 72% gas-dependent. Median income is the lowest in the nation at $48,610."},
  'WV': {outage:22, solar:3.8, wind:2.1, deployed:0.8, coal:88, gas:5, nuclear:0, renewable:0.8, hydro:1, other:5.2,
    insight:"88% of West Virginia's electricity comes from coal. They have mountaintop wind potential that could power the state 3x over. Coal plants are literally crumbling from age. The state that built America's energy is being left behind."},
  'AL': {outage:18, solar:5.1, wind:0.2, deployed:3, coal:15, gas:46, nuclear:28, renewable:3, hydro:6, other:2,
    insight:"Alabama has solid nuclear baseload but remains heavily gas-dependent. 5.1 peak sun hours and barely any solar deployed. TVA controls most generation, limiting competitive renewable deployment."},
  'KY': {outage:17, solar:4.0, wind:0.5, deployed:1, coal:69, gas:20, nuclear:0, renewable:1, hydro:5, other:5,
    insight:"Kentucky still gets 69% from coal, one of the highest in the nation. Solar potential is moderate but wind resources in eastern mountains are strong. No renewable portfolio standard exists in the state."},
  'TX': {outage:12, solar:5.8, wind:8.2, deployed:18, coal:14, gas:46, nuclear:8, renewable:30, hydro:0.3, other:1.7,
    insight:"Texas is a paradox: #1 in wind generation, massive solar growth, AND had the deadliest grid failure in modern history (246 deaths, Feb 2021). High renewable deployment but an isolated grid (ERCOT) with no federal interconnection as a safety net."},
  'ME': {outage:19, solar:3.4, wind:1.8, deployed:5, coal:0, gas:14, nuclear:0, renewable:25, hydro:28, other:33,
    insight:"Maine's outages are driven by extreme weather (ice storms, nor'easters) hitting old rural infrastructure. Lots of hydro and growing wind, but distribution lines through forested areas are uniquely vulnerable."},
  'CA': {outage:7, solar:6.0, wind:3.5, deployed:38, coal:0, gas:37, nuclear:9, renewable:38, hydro:10, other:6,
    insight:"California leads in renewables (38%) but still has pockets of poor reliability, especially in rural/wildfire-prone areas. Curtailed 3.4M MWh of clean energy in 2024 because storage couldn't absorb it fast enough."},
  'FL': {outage:10, solar:5.5, wind:0.1, deployed:6, coal:4, gas:72, nuclear:12, renewable:6, hydro:0, other:6,
    insight:"Florida has enormous solar potential but utility-dominated politics have slowed rooftop solar and storage. Hurricane vulnerability makes the case for microgrids obvious. Babcock Ranch proved it works."},
  'NY': {outage:6, solar:3.8, wind:2.0, deployed:8, coal:0, gas:35, nuclear:25, renewable:8, hydro:22, other:10,
    insight:"New York has aggressive targets (6 GW storage by 2030) but congestion between upstate wind generation and downstate demand is a major bottleneck. The grid literally can't move the clean energy where it's needed."},
};

// Energy source for top 5 GridGap states
const sourceStates = ['LA','MS','WV','AL','KY'];
const sourceCoal = [4, 8, 88, 15, 69];
const sourceGas  = [68, 72, 5, 46, 20];
const sourceNuke = [16, 13, 0, 28, 0];
const sourceRen  = [2, 1, 0.8, 3, 1];
const sourceOther= [10, 6, 6.2, 8, 10];

// International comparison (SAIDI hours)
const countries = ['India','US','UK','Germany','France','Japan','S. Korea','Singapore'];
const countryHours = [50, 7.5, 4.2, 3.1, 2.8, 2.4, 1.2, 0.1];

// =========================================================
//  CHART 1: Outage Hours
// =========================================================
new Chart(document.getElementById('outageChart'), {
  type: 'bar',
  data: {
    labels: outageStates,
    datasets: [{
      label: 'Outage Hours/Yr',
      data: outageHours,
      backgroundColor: outageHours.map(h => h >= 20 ? 'rgba(248,113,113,0.8)' : h >= 15 ? 'rgba(251,191,36,0.7)' : 'rgba(251,191,36,0.5)'),
      borderColor: outageHours.map(h => h >= 20 ? '#f87171' : '#fbbf24'),
      borderWidth: 2,
      borderRadius: 6,
    }]
  },
  options: {
    indexAxis: 'y',
    responsive: true,
    plugins: {
      legend: { display: false },
      tooltip: { callbacks: { label: ctx => ctx.parsed.x + ' hours/year' }}
    },
    scales: {
      x: {
        title: { display: true, text: 'Hours Without Power / Customer / Year', color: '#64748b' },
        grid: { color: '#1e293b' },
        ticks: { color: '#94a3b8' }
      },
      y: { ticks: { color: '#94a3b8' }, grid: { display: false } }
    }
  }
});

// =========================================================
//  CHART 2: Mismatch (Scatter)
// =========================================================
const mismatchData = outageStates.map((s, i) => ({
  x: solarPotential[i],
  y: outageHours[i],
  label: s
}));

new Chart(document.getElementById('mismatchChart'), {
  type: 'scatter',
  data: {
    datasets: [{
      label: 'States',
      data: mismatchData,
      backgroundColor: mismatchData.map(d => d.y >= 20 ? '#f87171' : '#fbbf24'),
      pointRadius: mismatchData.map(d => 8 + d.y / 4),
      pointHoverRadius: 14,
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { display: false },
      tooltip: {
        callbacks: {
          label: ctx => {
            const d = mismatchData[ctx.dataIndex];
            return d.label + ': ' + d.x + ' sun hrs, ' + d.y + ' outage hrs';
          }
        }
      }
    },
    scales: {
      x: {
        title: { display: true, text: 'Solar Potential (Peak Sun Hours/Day)', color: '#64748b' },
        grid: { color: '#1e293b' },
        ticks: { color: '#94a3b8' },
        min: 3, max: 6.5
      },
      y: {
        title: { display: true, text: 'Outage Hours / Year', color: '#64748b' },
        grid: { color: '#1e293b' },
        ticks: { color: '#94a3b8' },
        min: 0
      }
    }
  },
  plugins: [{
    afterDraw: function(chart) {
      const ctx = chart.ctx;
      ctx.font = '11px system-ui';
      ctx.fillStyle = '#94a3b8';
      ctx.textAlign = 'center';
      chart.data.datasets[0].data.forEach((d, i) => {
        const meta = chart.getDatasetMeta(0).data[i];
        ctx.fillText(mismatchData[i].label, meta.x, meta.y - 14);
      });
    }
  }]
});

// =========================================================
//  GridGap Index Table
// =========================================================
const indexBody = document.getElementById('indexBody');
gridgapData.forEach(d => {
  const tr = document.createElement('tr');
  tr.innerHTML =
    '<td><span class="rank-badge rank-' + d.rank + '">' + d.rank + '</span></td>' +
    '<td style="font-weight:600;">' + d.state + '</td>' +
    '<td style="color:#f87171;font-weight:600;">' + d.outage + ' hrs</td>' +
    '<td style="color:#fbbf24;">' + d.solar + '</td>' +
    '<td>' + d.deployed + '</td>' +
    '<td style="color:#94a3b8;">' + d.income + '</td>' +
    '<td><div style="display:flex;align-items:center;gap:8px;"><span style="font-weight:700;color:#fb923c;min-width:28px;">' + d.score + '</span><div class="gap-bar" style="width:' + d.barW + 'px;"></div></div></td>';
  indexBody.appendChild(tr);
});

// =========================================================
//  CHART 4: State Detail
// =========================================================
let stateDetailChart = null;
function updateStateDetail() {
  const st = document.getElementById('stateSelect').value;
  const d = stateDetail[st];
  if (stateDetailChart) stateDetailChart.destroy();
  stateDetailChart = new Chart(document.getElementById('stateDetailChart'), {
    type: 'bar',
    data: {
      labels: ['Outage Hrs/Yr', 'Solar (hrs/day)', 'Wind (m/s)', 'Renewable %'],
      datasets: [{
        data: [d.outage, d.solar, d.wind, d.deployed],
        backgroundColor: ['#f87171', '#fbbf24', '#38bdf8', '#34d399'],
        borderRadius: 6,
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false } },
      scales: {
        y: { grid: { color: '#1e293b' }, ticks: { color: '#94a3b8' } },
        x: { ticks: { color: '#94a3b8' }, grid: { display: false } }
      }
    }
  });
  document.getElementById('stateInsight').innerHTML = '<strong>Insight:</strong> ' + d.insight;
}
document.getElementById('stateSelect').onchange = updateStateDetail;
updateStateDetail();

// =========================================================
//  CHART 5: Energy Source Stacked Bar
// =========================================================
new Chart(document.getElementById('sourceChart'), {
  type: 'bar',
  data: {
    labels: sourceStates,
    datasets: [
      { label: 'Coal', data: sourceCoal, backgroundColor: '#6b7280' },
      { label: 'Natural Gas', data: sourceGas, backgroundColor: '#f87171' },
      { label: 'Nuclear', data: sourceNuke, backgroundColor: '#a78bfa' },
      { label: 'Renewable', data: sourceRen, backgroundColor: '#34d399' },
      { label: 'Other', data: sourceOther, backgroundColor: '#334155' },
    ]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { labels: { color: '#94a3b8', boxWidth: 12 } },
      tooltip: { callbacks: { label: ctx => ctx.dataset.label + ': ' + ctx.parsed.y + '%' } }
    },
    scales: {
      x: { stacked: true, ticks: { color: '#94a3b8' }, grid: { display: false } },
      y: {
        stacked: true,
        title: { display: true, text: '% of Electricity Generation', color: '#64748b' },
        grid: { color: '#1e293b' },
        ticks: { color: '#94a3b8', callback: v => v + '%' },
        max: 100
      }
    }
  }
});

// =========================================================
//  SIMULATOR
// =========================================================
const simStates = ['LA','MS','WV','AL','KY','MI','OK','SC','ME','TX'];
const simBaseline = [32, 28, 22, 18, 17, 15, 14, 13, 19, 12];
// Max improvement per state: solar+storage can reduce outages by this much (DOE model)
const simMaxReduction = [0.65, 0.62, 0.55, 0.60, 0.58, 0.50, 0.55, 0.58, 0.45, 0.52];

let simChart = new Chart(document.getElementById('simChart'), {
  type: 'bar',
  data: {
    labels: simStates,
    datasets: [
      {
        label: 'Current Outage Hrs',
        data: [...simBaseline],
        backgroundColor: 'rgba(248,113,113,0.6)',
        borderColor: '#f87171',
        borderWidth: 1,
        borderRadius: 4,
      },
      {
        label: 'After Deployment',
        data: [...simBaseline],
        backgroundColor: 'rgba(52,211,153,0.6)',
        borderColor: '#34d399',
        borderWidth: 1,
        borderRadius: 4,
      }
    ]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { labels: { color: '#94a3b8', boxWidth: 12 } },
      tooltip: { callbacks: { label: ctx => ctx.dataset.label + ': ' + ctx.parsed.y.toFixed(1) + ' hrs' } }
    },
    scales: {
      x: { ticks: { color: '#94a3b8' }, grid: { display: false } },
      y: {
        title: { display: true, text: 'Outage Hours / Customer / Year', color: '#64748b' },
        grid: { color: '#1e293b' },
        ticks: { color: '#94a3b8' },
        min: 0
      }
    }
  }
});

const deploySlider = document.getElementById('deploySlider');
const deployLabel = document.getElementById('deployLabel');
const impactResult = document.getElementById('impactResult');

function updateSim() {
  const pct = parseInt(deploySlider.value);
  deployLabel.textContent = pct + '%';

  const newOutages = simBaseline.map((base, i) => {
    const reduction = base * simMaxReduction[i] * (pct / 100);
    return Math.round((base - reduction) * 10) / 10;
  });

  simChart.data.datasets[1].data = newOutages;
  simChart.update();

  if (pct > 0) {
    const totalSaved = simBaseline.reduce((sum, b, i) => sum + (b - newOutages[i]), 0);
    const avgReduction = Math.round(totalSaved / simBaseline.length * 10) / 10;
    const costSaved = Math.round(pct / 100 * 18);
    impactResult.innerHTML =
      'Deploying solar + storage to <strong>' + pct + '%</strong> of underserved counties: ' +
      '<strong>' + avgReduction + ' fewer outage hours</strong> on average per state. ' +
      'Estimated savings: <strong>$' + costSaved + 'B/year</strong> in outage-related economic losses.';
  } else {
    impactResult.innerHTML = 'Drag the slider to deploy solar + storage to underserved counties.';
  }
}
deploySlider.oninput = updateSim;

// =========================================================
//  CHART 6: International Comparison
// =========================================================
new Chart(document.getElementById('worldChart'), {
  type: 'bar',
  data: {
    labels: countries,
    datasets: [{
      label: 'Outage Hours/Year',
      data: countryHours,
      backgroundColor: countries.map(c => c === 'US' ? 'rgba(248,113,113,0.8)' : 'rgba(56,189,248,0.5)'),
      borderColor: countries.map(c => c === 'US' ? '#f87171' : '#38bdf8'),
      borderWidth: 2,
      borderRadius: 6,
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { display: false },
      tooltip: { callbacks: { label: ctx => ctx.parsed.y + ' hours/year' }}
    },
    scales: {
      y: {
        title: { display: true, text: 'Avg Outage Hours / Customer / Year', color: '#64748b' },
        grid: { color: '#1e293b' },
        ticks: { color: '#94a3b8' }
      },
      x: { ticks: { color: '#94a3b8' }, grid: { display: false } }
    }
  }
});
</script>
</body>
</html>
